# 转头识别系统 - Head Pose Detection System

基于 MediaPipe 和 OpenCV 的实时头部姿态检测系统，可以准确识别头部的上下、左右转动和旋转角度。

## 功能特点

- **实时检测**：基于摄像头的实时头部姿态分析
- **三维角度**：
  - **Pitch（俯仰角）**：上下点头，范围 -90° 到 +90°
  - **Yaw（偏航角）**：左右转头，范围 -90° 到 +90°
  - **Roll（翻滚角）**：左右倾斜，范围 -90° 到 +90°
- **可视化界面**：
  - 实时显示三个角度的数值和颜色标识
  - 方向指示器（圆形指针）
  - 角度条形图
  - 人脸关键点标注
  - 方向文字提示

## 技术栈

- **Python 3.9+**
- **MediaPipe**：Google 开源的人脸网格检测库
- **OpenCV**：计算机视觉处理和可视化
- **NumPy**：数值计算

## 安装步骤

### 1. 克隆或下载项目

```bash
cd /path/to/the/project
```

### 2. 创建虚拟环境（已完成）

```bash
python3 -m venv venv
```

### 3. 激活虚拟环境

**macOS/Linux:**
```bash
source venv/bin/activate
```

**Windows:**
```bash
venv\Scripts\activate
```

### 4. 安装依赖（已完成）

```bash
pip install -r requirements.txt
```

## 使用方法

### 启动程序

激活虚拟环境后，运行主程序：

```bash
python head_pose_detection.py
```

### 操作说明

1. 程序启动后会自动打开摄像头
2. 将脸部对准摄像头，保持合适距离（约 50-100cm）
3. 程序会实时显示：
   - 视频画面（镜像模式）
   - 三个角度值及颜色标识
   - 方向文字（如"向左"、"向下"等）
   - 右上角的方向指示器
   - 右侧的角度条形图
4. 按 **`q`** 键退出程序

## 界面说明

### 颜色标识

- **绿色**：角度 < 10°，头部基本正面
- **黄色**：10° ≤ 角度 < 30°，轻微转动
- **红色**：角度 ≥ 30°，大幅转动

### 角度含义

| 角度类型 | 正值含义 | 负值含义 |
|---------|---------|---------|
| **Pitch（俯仰）** | 向下看 | 向上看 |
| **Yaw（偏航）** | 向右转 | 向左转 |
| **Roll（翻滚）** | 向右倾斜 | 向左倾斜 |

### 方向判断阈值

- 角度 > 15°：判断为该方向转动
- 角度 < 15°：判断为正面或中立位置

## 项目结构

```
转头识别系统/
├── head_pose_detection.py    # 主程序
├── requirements.txt           # 依赖包列表
├── venv/                     # 虚拟环境目录
└── README.md                 # 使用说明（本文件）
```

## 核心原理

1. **人脸检测**：使用 MediaPipe Face Mesh 检测 468 个人脸关键点
2. **关键点选择**：选择 6 个稳定的关键点（鼻尖、下巴、眼角、嘴角）
3. **PnP 求解**：通过 OpenCV 的 `solvePnP` 函数，基于 2D 图像点和 3D 模型点计算头部姿态
4. **欧拉角转换**：将旋转矩阵转换为 Pitch、Yaw、Roll 三个欧拉角
5. **可视化**：在画面上绘制角度信息、方向指示和图形元素

## 常见问题

### Q1: 摄像头无法打开
**A**: 请检查：
- 摄像头是否被其他程序占用
- 系统是否授予了摄像头权限
- 尝试更改 `cap = cv2.VideoCapture(0)` 中的数字（0, 1, 2...）

### Q2: 检测不稳定或不准确
**A**: 建议：
- 确保光线充足
- 保持脸部完整在画面中
- 距离摄像头 50-100cm
- 避免快速晃动

### Q3: 程序运行缓慢
**A**: 可以尝试：
- 降低摄像头分辨率（修改 `cap.set` 参数）
- 关闭其他占用 CPU 的程序
- 确保使用了虚拟环境中的 Python

### Q4: 角度值与实际感觉不符
**A**: 这是正常的，因为：
- 使用的是简化的相机模型
- 不同人的脸型会影响估计
- 可以根据需要调整 `model_points` 中的 3D 模型坐标

## 依赖版本

详见 `requirements.txt`：
- opencv-python==4.8.1.78
- mediapipe==0.10.9
- numpy==1.24.3

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，欢迎反馈。

---

**祝使用愉快！**
